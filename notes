Tanker om trÃ¦:


NÃ¥r du installerer NixOS, sÃ¦tter du manuelt hostname Ã©n gang, f.eks.:

hostnamectl set-hostname desktop

og tilfÃ¸jer det til /etc/nixos/configuration.nix (eller configuration.nix trÃ¦kker det fra en eksisterende env-variabel).

Derefter kan du bruge noget som dette i din configuration.nix:
ðŸ’¡ Dynamisk host-afhÃ¦ngig konfiguration

{ lib, ... }:
let
  host = builtins.getEnv "HOSTNAME";  # Hent hostname fra env
in {
  imports =
    [ ./common.nix ]  # Alle hosts deler dette
    ++ lib.optionals (host == "desktop") [ ./hosts/desktop.nix ]
    ++ lib.optionals (host == "laptop") [ ./hosts/laptop.nix ];
}

ðŸ”¥ Strukturen af dine filer

ðŸ“‚ NixOS Config Repo

/etc/nixos/
â”œâ”€â”€ configuration.nix  # Hovedkonfig
â”œâ”€â”€ common.nix         # FÃ¦lles indstillinger
â”œâ”€â”€ hosts/
â”‚   â”œâ”€â”€ desktop.nix    # Desktop-specifikke ting
â”‚   â”œâ”€â”€ laptop.nix     # Laptop-specifikke ting

âœ… Hvordan det virker

    Ved installation sÃ¦tter du hostname manuelt.
    NÃ¥r du rebooter, trÃ¦kker configuration.nix det automatisk og henter de rigtige filer.
    Nu kan du versionere configuration.nix i Git, og den vil automatisk vÃ¦lge den rigtige konfiguration, afhÃ¦ngigt af maskinen.

ðŸ’¡ Bonus: Hvis du bruger Home Manager, kan du bruge prÃ¦cis samme trick til at hÃ¥ndtere bruger-specifikke configs!


(prÃ¦-flakes. Den hovedpine tager vi senere)

C = Common
D = Desktop-only
L = Laptop-only
U = Unknown, could be separate settings

C Locale and keymaps
U Pipewire - scratching settings for D
U Nvidia
C Neovim
C Hyprland
C GNOME
U Bootloader
U System packages
U Home Manager - packages
C User
C Zsh
C Kitty
CU Firefox  (graphics acceleration on laptop?)
D mpv
D mpd + client
CU Cursor tweaks and other graphics stuff


So basically:
- Modules/Common
-- Core (boot, GDM, Pipewire)
-- User (locale, user, etc.)
-- CLI tools
-- GNOME
-- Hyprland
-- Neovim
-- Zsh
-- Kitty
-- Firefox
- Modules/Desktop
-- Pipewire scratching
-- Firefox tweaks ?
-- Nvidia
-- Multimedia
- Modules/Laptop
-- Whatever graphics and stuff
-- Power management


configuration => smol, start
hardware-configuration => unmanaged
modules
=> home-manager
=> => home-manager.nix
=> => hyprland.nix
=> => neovim.nix
=> => zsh.nix
=> system
=> => common.nix
=> => nvidia.nix
=> => services.nix